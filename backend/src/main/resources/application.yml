spring:
  application:
    name: "bugshot"

  # 프로파일 설정 (기본값: local)
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${DB_URL:jdbc:mysql://localhost:3306/error_monitor}
    username: ${DB_USER:root}
    password: ${DB_PW:password}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    database: mysql
    database-platform: org.hibernate.dialect.MySQLDialect
    show-sql: true
    hibernate:
      ddl-auto: update # JPA가 자동으로 테이블 생성/수정
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

  # Flyway 비활성화 (JPA만 사용)
  flyway:
    enabled: false

  # Mail Configuration
  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000

  # Redis Configuration
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      lettuce:
        pool:
          max-active: 10
          max-idle: 10
          min-idle: 2
      timeout: 3000ms

  cache:
    type: redis
    redis:
      time-to-live: 600000 # 10 minutes in milliseconds
      cache-null-values: false
      use-key-prefix: true
      key-prefix: "bugshot:"

  # Note: OAuth2 인증은 Frontend(NextAuth)에서 처리
  # 백엔드는 X-User-Id 헤더로 사용자를 식별합니다

# Server Port (8081 - 8080은 다른 프로젝트에서 사용 중)
server:
  port: ${SERVER_PORT:8081}

# Actuator 설정
management:
  endpoints:
    web:
      exposure:
        include: health, info, metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: always

# 커스텀 설정
app:
  # Frontend URL (알림에서 사용)
  frontend:
    base-url: ${FRONTEND_BASE_URL:http://localhost:3000}

  # Internal API Secret (for BFF pattern - server-to-server authentication)
  internal-api-secret: ${INTERNAL_API_SECRET:}

  # Email Notification
  email:
    from: ${EMAIL_FROM:noreply@bugshot.io}
    from-name: ${EMAIL_FROM_NAME:BugShot}

  # Discord Bot
  discord:
    bot-token: ${DISCORD_BOT_TOKEN:}

  # Cloudflare R2 (S3 Compatible Storage - 무료 10GB + 무제한 Egress!)
  cloudflare:
    r2:
      account-id: ${CLOUDFLARE_R2_ACCOUNT_ID:}
      bucket-name: ${CLOUDFLARE_R2_BUCKET:bugshot-replays}
      access-key: ${CLOUDFLARE_R2_ACCESS_KEY:}
      secret-key: ${CLOUDFLARE_R2_SECRET_KEY:}

  # Session Replay
  session-replay:
    max-file-size: 10485760 # 10MB
    retention-days: 30
